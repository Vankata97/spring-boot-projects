DROP TABLE REGISTERED_CLIENTS;
DROP SEQUENCE reg_clients_seq;
DROP TRIGGER reg_clients_numeration;
/
CREATE TABLE REGISTERED_CLIENTS(
ID_Client INT,
E_MAIL_rc VARCHAR2(50) NOT NULL,
CONSTRAINT pk_clients PRIMARY KEY(ID_Client)
);
/
CREATE SEQUENCE reg_clients_seq;
/
CREATE TRIGGER reg_clients_numeration
BEFORE INSERT ON registered_clients
FOR EACH ROW
BEGIN
  SELECT reg_clients_seq.nextval
  INTO :new.ID_client
  FROM dual;
END;
/
SELECT*FROM REGISTERED_CLIENTS;
/
--TRUNCATE TABLE PERSONAL_INFORMATION;
CREATE TABLE PERSONAL_INFORMATION(
ID_Client INT PRIMARY KEY,
FIRSTNAME VARCHAR2(50) NOT NULL,
LASTNAME VARCHAR2(50) NOT NULL,
PHONE VARCHAR2(50) NOT NULL,
ADDRESS VARCHAR2(100) NOT NULL,
CITIZENSHIP VARCHAR2(50),
AGE INT NOT NULL,
MARITAL_STATUS VARCHAR2(50),
CHILDREN INT DEFAULT(0),
CONSTRAINT PERSONAL_INFORMATION_fk FOREIGN KEY(ID_Client) REFERENCES REGISTERED_CLIENTS(ID_Client)
);
/
--TRUNCATE TABLE FINANCIAL_STATUS;
CREATE TABLE FINANCIAL_STATUS(
ID_Client INT PRIMARY KEY,
JOB_POSITION VARCHAR2(50),
TYPE_OF_CONTRACT VARCHAR2(25),
MONTHLY_SALARY NUMBER(8,2) NOT NULL,
OTHER_INCOMES NUMBER(8,2) DEFAULT(0),
OTHER_LOANS NUMBER(8,2) DEFAULT(0),
CONSTRAINT  FINANCIAL_STATUS_RC_fk FOREIGN KEY(ID_Client ) REFERENCES REGISTERED_CLIENTS(ID_Client)
);
/

--TRUNCATE TABLE BANK_OFFER;
CREATE TABLE BANK_OFFER(
ID_CLIENT INT,
MIN_AMOUNT NUMBER(8,2) NOT NULL,
MAX_AMOUNT NUMBER(8,2) NOT NULL,
MIN_MONTHS INT NOT NULL,
MAX_MONTHS INT NOT NULL,
INTEREST NUMBER NOT NULL,
CONSTRAINT bank_offer_pk PRIMARY KEY(ID_CLIENT),
CONSTRAINT bank_offer_rc_fk FOREIGN KEY(ID_CLIENT) REFERENCES REGISTERED_CLIENTS(ID_Client)
);
/
--TRUNCATE TABLE CLIENT_RESPONSE;
CREATE TABLE CLIENT_RESPONSE(
ID_CLIENT INT UNIQUE,
AMOUNT NUMBER(8,2) DEFAULT(10000),
MONTHS INT DEFAULT(18),
CONSTRAINT CLIENT_RESPONSE_fk FOREIGN KEY(ID_CLIENT)REFERENCES REGISTERED_CLIENTS(e_mail_rc)
);
/
--TRUNCATE TABLE REGISTRATION_TOKEN;
CREATE TABLE REGISTRATION_TOKEN(
ID_CLIENT INT UNIQUE,
TOKEN_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TOKEN VARCHAR2(255) UNIQUE,
CONSTRAINT REGISTRATION_TOKEN_RC_fk FOREIGN KEY(ID_CLIENT)REFERENCES REGISTERED_CLIENTS(ID_CLIENT)
);
/
drop TABLE REGISTRATION_FORM;
CREATE TABLE REGISTRATION_FORM(
ID_CLIENT INT PRIMARY KEY,
USERNAME VARCHAR2(25) NOT NULL,
PASSWORD VARCHAR2(25) NOT NULL,
ROLE VARCHAR2(25) DEFAULT 'USER',
CONSTRAINT REGISTRATION_FORM_RC_fk FOREIGN KEY(ID_CLIENT) REFERENCES registered_clients(ID_CLIENT)
);
/
--TRUNCATE TABLE REGISTERED_CLIENTS_INFO;
CREATE TABLE REGISTERED_CLIENTS_INFO(
                                        ID_Client INT PRIMARY KEY,
                                        E_MAIL_RC VARCHAR2(50) UNIQUE,
                                        FIRSTNAME VARCHAR2(50) NOT NULL,
                                        LASTNAME VARCHAR2(50) NOT NULL,
                                        PHONE VARCHAR2(50),
                                        ADDRESS VARCHAR2(100),
                                        AMOUNT NUMBER(8,2) NOT NULL,
                                        MONTHS INT NOT NULL,
                                        CONSTRAINT REGISTERED_CLIENTS_DATA_fk FOREIGN KEY(ID_Client ) REFERENCES REGISTERED_CLIENTS(ID_Client)
);
/
CREATE VIEW REGISTERED_CLIENTS_DATA AS
SELECT rc.E_MAIL_RC, pi.FIRSTNAME, pi.LASTNAME, pi.PHONE,
       pi.ADDRESS,cr.AMOUNT, cr.MONTHS
FROM REGISTERED_CLIENTS rc, PERSONAL_INFORMATION pi, BANK_OFFER_RESPONSE cr
WHERE rc.id_client=pi.id_client AND rc.ID_CLIENT=cr.id_client;
